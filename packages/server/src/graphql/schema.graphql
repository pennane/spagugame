scalar Date

enum GameType {
  FIND_FOUR
  TICK_TACK_TOE
}

enum UserRole {
  USER
  ADMIN
}

# Static mongo types

## User

type User {
  _id: ID!
  githubId: ID!
  userName: String!
  description: String
  stats(gameTypes: [GameType!]): [UserStats!]!
  playedGames(gameTypes: [GameType!], first: Int): [PlayedGame!]!
  roles: [UserRole!]!
  joinedAt: Date!
}

input UserInput {
  userName: String
  description: String
}

## UserStats

type UserStats {
  _id: ID!
  userId: ID!
  gameType: GameType!
  totalWins: Int!
  elo: Float!
}

## Game

type Game {
  _id: ID!
  type: GameType!
  name: String!
  description: String!
  ongoingGames: [OngoingGame!]!
  minPlayers: Int!
  maxPlayers: Int!
}

## PlayedGame

type PlayedGame {
  _id: ID!
  ongoingGameId: ID!
  gameType: GameType!
  playerIds: [ID!]!
  playerScores: [Int!]!
  playerElosBefore: [Float!]!
  playerElosAfter: [Float!]!
  startedAt: Date!
  finishedAt: Date!
  finalState: String
}

# Ongoing game types

type OngoingGamePlayer {
  userId: ID!
  score: Int!
  ready: Boolean!
}

enum OngoingGameProcessState {
  NOT_STARTED
  STARTING
  ONGOING
  FINISHED
  CANCELLED
}

type OngoingGame {
  _id: ID!
  gameType: GameType!
  processState: OngoingGameProcessState!
  jsonState: String!
  players: [OngoingGamePlayer!]!
  currentTurn: ID
  startedAt: Float
  startsIn: Int
  isPrivate: Boolean!
}

type OngoingGameStateChange {
  _id: ID
  gameType: GameType
  processState: OngoingGameProcessState
  jsonState: String
  players: [OngoingGamePlayer!]
  currentTurn: ID
  startsIn: Int
}

type Query {
  ongoingGame(ongoingGameId: ID!): OngoingGame!
  user(id: ID!): User
  users(ids: [ID!]!): [User!]!
  currentUser: User
  game(gameType: GameType): Game
  games: [Game!]!
  usersStats(userIds: [ID!]!, gameType: GameType!): [UserStats!]!
  playedGame(id: ID!): PlayedGame
  playedGames(gameTypes: [GameType!], first: Int): [PlayedGame!]!
}

type Subscription {
  ongoingGameStateChange(ongoingGameId: ID!): OngoingGameStateChange!
  newOngoingGame(gameType: GameType): OngoingGame!
}

type Mutation {
  createOngoingGame(gameType: GameType!, isPrivate: Boolean): OngoingGame!
  joinOngoingGame(ongoingGameId: ID!): OngoingGame!
  leaveOngoingGame(ongoingGameId: ID!): OngoingGame!
  playTurn(ongoingGameId: ID!, json: String!): OngoingGame!
  toggleReady(ongoingGameId: ID!, ready: Boolean!): OngoingGame!
  updateUser(userInput: UserInput): User!
}
